<template>
    <div class="sub-menu">
        <el-menu :default-active="activeMenu"
                 :default-openeds="menuOpeneds"
                 class="el-menu-vertical-demo"
                 router>
            <menu-item v-for="(item,index) in menus" :item="item" :index="index" :key="index"></menu-item>
            
        </el-menu>
    </div>
</template>

<script>
import { mapGetters } from 'vuex';
import MenuItem from "../components/MenuItem";

export default {
  name: "erpmenu",
  data() {
    return {
      menuOpeneds: ["0"]
    };
  },
  computed: {
    // menu() {
    //   let menuData = {
    //     tenancy: [
    //       {
    //         title: "资产管理",
    //         children: [
    //           {
    //             path: "/inner/building",
    //             title: "楼宇管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "招商资源管理",
    //         children: [
    //           {
    //             path: "/",
    //             title: "物业性质"
    //           }
    //         ]
    //       },
    //       {
    //         title: "合同管理",
    //         children: [
    //           {
    //             path: "/inner/intention",
    //             title: "意向合同管理"
    //           }
    //         ]
    //       }
    //     ],
    //     finance: [
    //       {
    //         title: "基础设置",
    //         children: [
    //           {
    //             path: "/finance/accountGroup",
    //             title: "结算组别"
    //           },
    //           {
    //             path: "/finance/taxRate",
    //             title: "税率设置"
    //           },
    //           {
    //             path: "/finance/cost",
    //             title: "费用项目"
    //           },
    //           {
    //             path: "/finance/taxRate2cost",
    //             title: "费用项目税率应用"
    //           },
    //           {
    //             path: "/finance/collectionAccount",
    //             title: "收款账户"
    //           }
    //         ]
    //       },
    //       {
    //         title: "履约保证金管理",
    //         children: [
    //           {
    //             path: "/finance/collectionMethods",
    //             title: "收款方式"
    //           },
    //           {
    //             path: "/finance/takeMargin",
    //             title: "履约保证金收取"
    //           },
    //           {
    //             path: "/finance/contractMargin",
    //             title: "合同履约保证金"
    //           },
    //           {
    //             path: "/finance/dealMargin",
    //             title: "履约保证金处理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "预付款管理",
    //         children: [
    //           {
    //             path: "/finance/advancePayMethods",
    //             title: "收款方式"
    //           },
    //           {
    //             path: "/finance/takeadvancePay",
    //             title: "预付款收取"
    //           },
    //           {
    //             path: "/finance/merchantAdvancePay",
    //             title: "商户预付款"
    //           },
    //           {
    //             path: "/finance/dealAdvancePay",
    //             title: "预付款处理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "不规则费用",
    //         children: [
    //           {
    //             path: "/finance/irregularCost",
    //             title: "不规则费用管理"
    //           },
    //           {
    //             path: "/finance/importIrregularCost",
    //             title: "不规则费用导入"
    //           }
    //         ]
    //       },
    //       {
    //         title: "费用调整管理",
    //         children: [
    //           {
    //             path: "/finance/costAdjust",
    //             title: "费用调整"
    //           }
    //         ]
    //       },
    //       {
    //         title: "免租管理",
    //         children: [
    //           {
    //             path: "/finance/rentFree",
    //             title: "免租管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "结算单管理",
    //         children: [
    //           {
    //             path: "/finance/generateAccount",
    //             title: "结算单生成"
    //           },
    //           {
    //             path: "/finance/accountManagement",
    //             title: "结算单管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "结算单调整",
    //         children: [
    //           {
    //             path: "/finance/accountAdjustType",
    //             title: "结算单调整类型"
    //           },
    //           {
    //             path: "/finance/accountAdjust",
    //             title: "结算单调整"
    //           }
    //         ]
    //       },
    //       {
    //         title: "收款管理",
    //         children: [
    //           {
    //             path: "/finance/payMethods",
    //             title: "收款方式"
    //           },
    //           {
    //             path: "/finance/payManagement",
    //             title: "收款管理"
    //           }
    //         ]
    //       }
    //     ],
    //     sales: [
    //       {
    //         title: "资产管理",
    //         children: [
    //           {
    //             path: "/inner/building",
    //             title: "楼宇管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "招商资源管理",
    //         children: [
    //           {
    //             path: "/",
    //             title: "物业性质"
    //           }
    //         ]
    //       }
    //     ],
    //     rebates: [
    //       {
    //         title: "资产管理",
    //         children: [
    //           {
    //             path: "/inner/building",
    //             title: "楼宇管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "招商资源管理",
    //         children: [
    //           {
    //             path: "/",
    //             title: "物业性质"
    //           }
    //         ]
    //       }
    //     ],
    //     visual: [
    //       {
    //         title: "资产管理",
    //         children: [
    //           {
    //             path: "/inner/building",
    //             title: "楼宇管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "招商资源管理",
    //         children: [
    //           {
    //             path: "/",
    //             title: "物业性质"
    //           }
    //         ]
    //       }
    //     ],
    //     merchant: [
    //       {
    //         title: "资产管理",
    //         children: [
    //           {
    //             path: "/inner/building",
    //             title: "楼宇管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "招商资源管理",
    //         children: [
    //           {
    //             path: "/",
    //             title: "物业性质"
    //           }
    //         ]
    //       }
    //     ],
    //     database: [
    //       {
    //         title: "资产管理",
    //         children: [
    //           {
    //             path: "/inner/building",
    //             title: "楼宇管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "招商资源管理",
    //         children: [
    //           {
    //             path: "/",
    //             title: "物业性质"
    //           }
    //         ]
    //       },
    //       {
    //         title: "合同管理",
    //         children: [
    //           {
    //             path: "/",
    //             title: "意向合同管理"
    //           }
    //         ]
    //       }
    //     ],
    //     system: [
    //       {
    //         title: "组织管理",
    //         children: [
    //           {
    //             path: "/system/area",
    //             title: "区域管理"
    //           },
    //           {
    //             path: "/system/shopping",
    //             title: "购物中心"
    //           },
    //           {
    //             path: "/system/dept",
    //             title: "部门管理"
    //           },
    //           {
    //             path: "/system/job",
    //             title: "职位管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "权限管理",
    //         children: [
    //           {
    //             path: "/system/user",
    //             title: "用户管理"
    //           },
    //           {
    //             path: "/system/role",
    //             title: "角色管理"
    //           }
    //         ]
    //       },
    //       {
    //         title: "操作日志",
    //         children: [
    //           {
    //             path: "/system/log",
    //             title: "操作日志"
    //           }
    //         ]
    //       }
    //     ]
    //   };
    //   switch (this.$route.matched[0].path) {
    //     case "/inner":
    //       return menuData.tenancy;
    //       break;
    //     case "/finance":
    //       return menuData.finance;
    //       break;
    //     case "/sales/salmanage":
    //       return menuData.tenancy;
    //       break;
    //     case "/rebates/terminal":
    //       return menuData.tenancy;
    //       break;
    //     case "/visual/visualization":
    //       return menuData.tenancy;
    //       break;
    //     case "/webinner/merchant":
    //       return menuData.tenancy;
    //       break;
    //     case "/database/dataview":
    //       return menuData.tenancy;
    //       break;
    //     case "/system":
    //       return menuData.system;
    //       break;
    //   }
    // },
    ...mapGetters([
      'permission_routers'
    ]),
    menus() {
      const activeParentPath = this.$route.matched[0].path;
      return this.permission_routers.filter(item => {
        return !item.hidden && item.path === activeParentPath;
      });
    },
    activeMenu() {
      let activeMenu = this.$route.path;
      console.log(this.menus);
      for(let i = 0; i < this.menus.length; i++) {
        let index = this.menus[i].children.find(child => {
          return this.$route.path.indexOf(child.path) >= 0;
        });
        if (index) {
          activeMenu = index.path;
          break; 
        } 
      }
      return activeMenu;
    }
  },
  created() {},
  methods: {},
  components: {
    MenuItem
  },
  watch: {
    $route: function(to, from) {
      let _topath = to.path.match(/\/?[^\/]+/g);
      let _frompath = from.path.match(/\/?[^\/]+/g);
      if (_topath[0] !== _frompath[0]) {
        this.menuOpeneds = ["0"];
      }
    }
  }
};
</script>

<style scoped>
div.sub-menu {
  overflow: hidden;
}
.el-menu .el-menu-item {
  font-size: 1em;
  height: 45px;
  line-height: 45px;
}
</style>